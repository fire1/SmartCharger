// automatically generated by arduino-cmake
#line 1 "C:/Users/Admin/Documents/Arduino/SmartCharger/SmartCharger.ino"
#include <Arduino.h>
#include <U8g2lib.h>
#include <Wire.h>

#line 7 "C:/Users/Admin/Documents/Arduino/SmartCharger/cmake-build-debug/SmartCharger_SmartCharger.ino.cpp"
#include "Arduino.h"

//=== START Forward: C:/Users/Admin/Documents/Arduino/SmartCharger/SmartCharger.ino
 void setup() ;
 void setup() ;
 void loop() ;
 void loop() ;
//=== END Forward: C:/Users/Admin/Documents/Arduino/SmartCharger/SmartCharger.ino
#line 3 "C:/Users/Admin/Documents/Arduino/SmartCharger/SmartCharger.ino"


U8G2_SSD1306_128X32_UNIVISION_F_HW_I2C u8g2(U8G2_R0);



const uint8_t pinVoltageControl = 3;
const uint8_t pinVoltageLoad = A0;

void setup() {
    u8g2.begin();
    Serial.begin(115200);
    pinMode(pinVoltageControl, OUTPUT);
    pinMode(pinVoltageLoad, INPUT);

}

uint8_t index = 0;
unsigned long readContainer = 0;
uint8_t voltageOffset = 0;

void loop() {
    while (Serial.available()) {
        int val = Serial.parseInt(); //read int or parseFloat for ..float...
        if (val > 0) {
            voltageOffset = val;
            analogWrite(pinVoltageControl, val);
            Serial.print(F("Output is "));
            Serial.println(val);
        }
    }

    if (index > 250) {
        uint8_t voltage = map(voltageOffset, 1, 255, 2, 13);
        uint8_t load = (readContainer / index);
        Serial.print(F(" Read: "));
        Serial.print(load);
        uint16_t amp = map(load, 110, 1, 200, 18);
        Serial.print(F("  Amp: "));
        Serial.println(amp);

        readContainer = 0;
        index = 0;
    }

    readContainer = analogRead(pinVoltageLoad) + readContainer;

    index++;
}